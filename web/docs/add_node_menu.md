# ComfyUI Add Node Menu (添加节点菜单)

这是一个为 ComfyUI 设计的高效节点添加工具。它提供了一个跟随鼠标的级联菜单，支持快捷键唤出、智能记忆位置、拖拽置顶和节点收藏功能，旨在极大地提升工作流搭建速度。

## ✨ 核心特性

- **快捷键唤出**：按下 `A` 键，菜单即刻在鼠标位置出现。
- **智能定位**：
    - 首次打开：菜单自动居中于鼠标。
    - 再次打开：自动记忆上次使用的分类，并将该分类对准鼠标，形成肌肉记忆。
- **拖拽置顶 (Pin)**：支持通过拖拽将常用节点或分组固定在菜单顶部。
- **节点收藏 (Favorite)**：标记常用节点，以醒目的绿色标识显示。
- **本地存储**：所有配置保存在用户目录下，方便迁移备份。
- **现代化 UI**：深色磨砂玻璃风格，流畅的动画效果。

## 📦 安装方法

1. 进入 ComfyUI 的 `custom_nodes` 目录。
2. 将本插件文件夹复制进去（或使用 `git clone`）。
3. 重启 ComfyUI。

## 📖 使用指南

### 1. 基础操作

- **唤出菜单**：在画布空白处（不要聚焦在输入框内），按下键盘上的 **`A`** 键。
- **添加节点**：点击菜单项即可将节点添加到**唤出菜单时鼠标所在的坐标**。
- **关闭菜单**：点击屏幕任意空白处，或按下 `Esc` 键。

### 2. 置顶功能 (Pinning)

置顶功能允许你将常用的节点或全部分组固定在当前列表的最上方。

- **添加置顶**：
    - **方法一（右键）**：在任意节点或分组上 **右键点击**，选择 `⭐ 置顶 (Pin)`。
    - **方法二（拖拽）**：按住节点或分组，将其拖拽到菜单列表的 **最上方**（或分隔线以上区域）。
    - **添加第一个置顶**：如果当前没有置顶项，直接将节点拖拽到菜单容器的**顶部边缘**，顶部会亮起蓝色光条，松开即可添加。
- **调整顺序**：在置顶区域内，可以通过拖拽上下移动来调整排列顺序。
- **取消置顶**：
    - **右键点击**置顶项，选择 `⭐ 取消置顶 (Unpin)`。
    - 或者将置顶项**拖拽**到下方的普通列表区域（显示红色背景），松开即可移除。

> 视觉提示：置顶项的背景色会比普通项稍深。
> 

### 3. 收藏功能 (Favorites)

收藏功能用于高亮标记你喜欢的节点，方便在长列表中快速识别。

- **操作**：在节点或分组上 **右键点击**，选择 `❤️ 收藏 (Favorite)`。
- **视觉效果**：已收藏的节点左侧会出现一条 **鲜艳的绿色竖线**。

### 4. 菜单分类逻辑

一级菜单分为三个区域（由上至下）：

1. **系统常用/置顶区**：包含被你置顶的分组，以及系统默认的常用分组（如 Utils, Sampling, Image 等）。
2. **普通分组区**：按字母顺序排列的其他节点分组。
3. **其他 (Others)**：未分类的节点。

## 💾 数据存储与迁移

本插件的所有用户配置（置顶、收藏、最后位置）均保存在 ComfyUI 的用户数据目录中，**不会因为清除浏览器缓存而丢失**。

- **数据路径**：
`ComfyUI/user/AlignLayout/`
- **文件说明**：
    - `pins.json`: 记录置顶信息。
    - `quick.json`: 记录收藏信息。
    - `last_category.json`: 记录最后一次打开的分类位置。

**如何迁移？**
如果你更换电脑或重装 ComfyUI，只需备份并复制 `ComfyUI/user/AlignLayout/` 文件夹到新环境即可保留所有习惯设置。

## 常见问题 (Q&A)

**Q: 按下 A 键没有反应？**
A: 请确保：

1. 你的鼠标焦点不在提示词输入框或搜索框内。
2. 并没有按住 Ctrl、Shift 或 Alt 等组合键。
3. 检查浏览器控制台 (F12) 是否有报错。

**Q: 收藏了某个分组，为什么里面的节点没有变绿？**
A: 收藏是独立的。收藏分组只会标记该分组本身（方便在一级菜单看到），不会级联标记其内部的所有子节点。

**Q: 置顶是全局的吗？**
A: 不完全是。置顶是“层级内”的。

- 在主菜单置顶“图像”分组，它会在主菜单置顶。
- 在“图像”分组内置顶“Load Image”节点，它只会在“图像”分组内置顶。